
<div class="admin-body">
  <h2><%= t("Step 1: Configure MongoDB") %></h2>

  <div id="mongo-status" style="display: none;">

  </div>
  
  <p>To store content, we need to connect to MongoDB. Please provide the location of your database here:

  <%- form %>
  <footer class="admin-install-links">
    <a id="form-submit" class="submit" href="#"><%= t("Create Database") %></a>
  </footer>
</div>



<script>

        (function L() {
      
          if(window.jQuery){

            $('.step1').addClass("current")
            
            // Ajax request to /admin/install/mongo/test
            function checkMongo() {
              
              $('#mongo-status').show();
              $('.submit').html("Connecting to MongoDB ...").addClass("loading");
              
              var dbUri = $(".database-uri").val();
              var postData = {"dbUri":dbUri};
              
              $.ajax({
                type: "POST",
                url: "/admin/installTest/mongo",
                dataType:"json",
                data:postData,
                success: function(res){
                  if(res.status === "OK") {
                    setTimeout(function() {
                      $('#install-mongo-form').submit();
                    }, 1500);
                  } else {
                    $('#mongo-status').html("<div class='error'>MongoDB connection failed, please check the details and try again.</div>");
                    $('.submit').html("Create Database").addClass("loading");
                  }
                }
              });
      
              // $('#install-mongo-form').submit();
      
              // $('#mongo-status').html()
            }
      
            $('#form-submit').click(function(event) {
              event.preventDefault();
              checkMongo();
            });
          
          } else {
            setTimeout(L, 50);
          }
          
        })();
      
    </script>